[[host-risk-score]]
== Host risk score

NOTE: This feature is available for {stack} versions 7.16.0 and newer and requires a www.elastic.co/pricing[Platinum subscription] or higher.

The host risk score feature highlights risky hosts from within your environment. It utilizes a transform with a scripted metric aggregation to calculate host risk scores based on alerts that were generated within the past five days. The transform runs hourly to update the score as new alerts are generated.

Each rule's contribution to the host risk score is based on the rule's risk score (`signal.rule.risk_score`) and a time decay factor to reduce the impact of stale alerts. The risk score is calculated using a weighted sum where rules with higher time-corrected risk scores also have higher weights. Each host risk score is normalized on a scale of 0 to 100.

Specific host attributes can boost the final risk score. For example, alert activity on a server poses a greater risk than that on a laptop. Therefore, the host risk score is 1.5 times higher if the host is a server. This boosted score is finalized after calculating the weighted sum of the time-corrected risks.

The following table shows how risk levels are applied to a host, based on the normalized risk score:

[width="100%",options="header"]
|==============================================
|Risk level |Host risk score

|Unknown |< 20
|Low |20-40
|Moderate |40-70
|High     | 70-90
|Critical  | > 90


|==============================================

[[enable-host-risk-score]]
[discrete]
=== Enable host risk score

NOTE: To enable the host risk score feature, you must have alerts in your environment. If you have previously enabled host risk score in {stack} versions 7.16 to 8.4 and are upgrading to version 8.5 or later, 

You can enable host risk score from the following places in the  {security-app}:

* The Entity Analytics dashboard 
* The *Host risk* tab on the Hosts page
* The *Host risk* tab on a host's details page

Or, in {kib}, you can enable host risk score from Dev Tools. 

TIP: You can also enable import host risk score dashboards in {kib} to analyze host risk score data. To learn how, refer to <<import-host-risk-score-dashboard>> in this topic. 

To enable host risk score from the Entity Analytics dashboard: 

. In the {security-app}, go to *Dashboards* -> *Entity Analytics*. 
. In the Host Risk Scores section, click *Enable* to install the module. 

To enable host risk score from the Hosts page: 

. Go to *Explore* -> *Hosts*. 
. Select the *Host risk* tab, then click *Enable* to install the module. 

[role="screenshot"]
image::images/enable-hrs.png[Enable Host Risk Score button]

To enable host risk score from a host's details page: 

. Go to *Explore* -> *Hosts*. 
. Select the *All hosts* tab, then click a host name. 
. On the details page, scroll down to the data tables, then select the *Host risk* tab. 
. Click *Enable* to install the module. 

[role="screenshot"]
image::images/enable-hrs-details-pg.gif[Shows how to enable host risk score from the host's details page]

To enable host risk score from Dev Tools in {kib}, open a browser window and enter the following URL:

[source,console]
----------------------------------
{KibanaURL}/s/{spaceID}/app/dev_tools#/console?load_from={KibanaURL}/s/{spaceID}/internal/risk_score/prebuilt_content/dev_tool/enable_user_risk_score
----------------------------------


NOTE: After enabling host risk score, you may get a message that says, "No host risk score data available to display." You may need to wait about an hour for data to be generated, or you can click *Restart* to force host risk score calculations to run immediately. 

[[upgrade-host-risk-score]]
[discrete]
=== Upgrade host risk score 

If you previously enabled host risk score in {stack} versions 8.4 and earlier and are upgrading to version 8.5 or later, there'll be an option to "upgrade" host risk score instead of enabling it. 

Before upgrading, be mindful of the following: 

* Previous host risk scores are deleted since the older data is not preserved, and new scores are created. However, if you want to retain the old host risk scores, you'll need to reindex the data _before_ upgrading the feature. Your data will then be stored in the `ml_{host|user}_risk_score_{spaceId}` and `ml_${host|user}_risk_score_latest_{spaceID}` indices. To learn how to do this, refer to {ref}/docs-reindex.html[Reindex API]. 

* You must edit your {cloud}/ec-manage-kibana-settings.html#ec-manage-kibana-settings[{kib} user settings] and remove the `xpack.securitySolution.enableExperimental:['riskyHostsEnabled']` feature flag. 

After this is done, you can proceed with upgrading the host risk score feature from any of the following places in the {security-app}:

* The Entity Analytics dashboard 
* The *Host risk* tab on the Hosts page
* The *Host risk* tab on a host's details page

[[import-host-risk-score-dashboard]]
[discrete]
=== Import the host risk score dashboard (Optional)

After you have enabled the host risk score feature, you can import pre-built dashboards to analyze risky hosts in your environment by doing the following:

. In {kib}, go to *Analytics* -> *Dashboard*. 
. In the search bar, type "host risk score", then select *Drilldown of Host Risk Score*. 

[role="screenshot"]
image::images/select-hrs-dashboard.png[Select host risk score dashboard]

[[analyze-host-risk-score]]
[discrete]
=== Analyze host risk score data from the dashboard

It is recommended you analyze hosts with the highest risk scores -- or those in the `Critical` and `Moderate` categories first.

[role="screenshot"]
image::images/full-dashboard.png[]

Use the histogram to track how the risk score for a particular host has changed over time. To specify a date range, use the date and time picker, or drag and select a time range within the histogram.

[role="screenshot"]
image::images/histogram.png[]

To go to the host's detail page, left-click any host's corresponding bar in the histogram, then select *Go to Host View*.

[role="screenshot"]
image::images/go-to-host-view.png[]

The data tables beneath the histogram display associated rules, users, and MITRE ATT&CK tactics of risky hosts. The table data is sorted in reverse chronological order by default, with the highest total risk score at the top. Use this information to triage alerts with the highest risk in your network.

[role="screenshot"]
image::images/data-tables.png[]

[discrete]
==== Visualize host risk score data in {elastic-sec}

Host risk score data appears in the following places in the {security-app}:

The *Overview* tab on the Alert details flyout:

[role="screenshot"]
image::images/score-in-flyout.png[]

The *Host risk classification* column in the All hosts table on the Hosts page:

[role="screenshot"]
image::images/hrs-all-hosts.png[]

The *Hosts by risk* tab on the Hosts page:

[role="screenshot"]
image::images/hosts-by-risk-tab.png[]

The *Overview* section on the Host details page:

[role="screenshot"]
image::images/hrs-overview-section.png[]

The *Hosts by risk* tab on the Host details page:

[role="screenshot"]
image::images/hosts-by-risk-details-page.png[]
