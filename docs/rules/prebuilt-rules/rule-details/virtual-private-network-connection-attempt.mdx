---
id: enSecurityVirtualPrivateNetworkConnectionAttempt
slug: /en/security/virtual-private-network-connection-attempt
title: Virtual Private Network Connection Attempt
description: Description to be written
tags: []
---

<div id="virtual-private-network-connection-attempt"></div>

Identifies the execution of macOS built-in commands to connect to an existing Virtual Private Network (VPN). Adversaries may use VPN connections to laterally move and control remote systems on a network.

**Rule type**: eql

**Rule indices**: 

* auditbeat-*
* logs-endpoint.events.*

**Severity**: low

**Risk score**: 21

**Runs every**: 5m

**Searches indices from**: now-9m ([Date Math format](((ref))/common-options.html#date-math), see also <DocLink id="enSecurityRulesUiCreate" section="set-the-rules-schedule">`Additional look-back time`</DocLink>)

**Maximum alerts per execution**: 100

**References**: 

* https://github.com/rapid7/metasploit-framework/blob/master/modules/post/osx/manage/vpn.rb
* https://www.unix.com/man-page/osx/8/networksetup/
* https://superuser.com/questions/358513/start-configured-vpn-from-command-line-osx

**Tags**: 

* Domain: Endpoint
* OS: macOS
* Use Case: Threat Detection
* Tactic: Lateral Movement

**Version**: 103

**Rule authors**: 

* Elastic

**Rule license**: Elastic License v2

## Investigation guide

```markdown

```

## Rule query

```js
process where host.os.type == "macos" and event.type in ("start", "process_started") and
  (
    (process.name : "networksetup" and process.args : "-connectpppoeservice") or
    (process.name : "scutil" and process.args : "--nc" and process.args : "start") or
    (process.name : "osascript" and process.command_line : "osascript*set VPN to service*")
  )

```

**Framework**: MITRE ATT&CK<sup>TM</sup>

* Tactic:
    * Name: Lateral Movement
    * ID: TA0008
    * Reference URL: https://attack.mitre.org/tactics/TA0008/
* Technique:
    * Name: Remote Services
    * ID: T1021
    * Reference URL: https://attack.mitre.org/techniques/T1021/

