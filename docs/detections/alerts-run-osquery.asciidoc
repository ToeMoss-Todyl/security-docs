[[alerts-run-osquery]]
== Run Osquery from a detection alert
{kibana-ref}/osquery.html[Osquery] allows you to run live queries against an alert's host to learn more about your infrastructure and operating systems. For example, with Osquery, you can search your system for indicators of compromise that might have contributed to the alert. You can then use this data to form your investigation and alert triage efforts.

[IMPORTANT]
============

You must complete the following to access Osquery and run searches against your hosts:

* Enable the {kibana-ref}/manage-osquery-integration.html[Osquery manager integration] on the host associated with the alert.
* Update your {kibana-ref}/osquery.html[role's privileges] to allow access to Osquery.
* Verify that {fleet-guide}/view-elastic-agent-status.html[{agent}'s status] is *Healthy*. Refer to {fleet-guide}/fleet-troubleshooting.html[{fleet} Troubleshooting] if it is not.
============


. Do one of the following from the Alerts table:
** Click the *View details* button to open the Alert details flyout, then click *Take action -> Run Osquery*.
** Select the *More actions* menu (*...*), then select *Run Osquery*.
. Choose to run a single query or a query pack.

+

[role="screenshot"]
image::images/setup-query.png[width=80%][height=80%][Shows how to set up a single query]

. Select one or more {agent}s or groups to query. Start typing in the search field to get suggestions for {agent}s by name, ID, platform, and policy.

+
NOTE: The host associated with the alert is automatically selected. You can specify additional hosts to query.

. Specify the query or pack to run:
** *Query*: Select a saved query or enter a new one in the text box beneath. After you enter the query, expand the **Advanced** section to view or set {kibana-ref}/osquery.html#osquery-map-fields[mapped ECS fields] included in the results from the live query. Mapping ECS fields is optional.
** *Pack*: Select from query packs that have been loaded and activated. After you select a pack, all of the queries in the pack are displayed.
+
TIP: Refer to {kibana-ref}/osquery.html#osquery-prebuilt-packs-queries[prebuilt packs] to learn about using and managing Elastic prebuilt packs.


. Click **Submit**. The timeout limit for single queries and packs is five minutes. If results have not been returned in five minutes, an error message displays.
+
TIP: To save the query for future use, click *Save for later* and define the ID,
description, and other {kibana-ref}/osquery.html#osquery-manage-query[details].

=== Review results for single queries

Results for single queries are displayed in a table beneath the query.

[role="screenshot"]
image::images/query-results.png[width=80%][height=80%][Shows query results]

=== Review results for pack queries

Results for each query in the pack are displayed when you run a query pack. Click the expand button to open results for each query.

=== Investigate query results

From the results table, you can:

* Navigate to *Discover* to dive deeper into the response.
* Use the drag-and-drop *Lens* editor to create visualizations.
* Click the *Timeline* button (image:images/timeline-button-osquery.png[Click markdown icon,20,20]) to investigate a single query result in Timeline or *Add to timeline investigation* to investigate all results.

+
TIP: An `action_ID` is generated when you run an Osquery query. The `action_ID` field and value pair is passed to the Timeline's KQL filter when you select the option to open all results in Timeline.
+

* View more information about the request, such as failures, by opening the *Status* tab.
