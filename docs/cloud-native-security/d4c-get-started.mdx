---
id: enSecurityD4cGetStarted
slug: /serverless/security/d4c-get-started
title: Get started with CWP
description: Secure your containerized workloads and start detecting threats and vulnerabilities.
tags: ["security","how-to","get-started"]
---

<div id="d4c-get-started"></div>

This page describes how to set up Container Workload Protection (CWP) for various use cases.

## Initial setup

First, you'll need to deploy Elastic's Defend for Containers integration to the Kubernetes clusters you wish to monitor.

1. Go to **Manage > Container Workload Security > Add D4C Integration**.
1. Name the integration. The default name, which you can change, is `cloud_defend-1`.
1. Optional â€” make any desired changes to the integration's policy by adjusting the **Selectors** and **Responses** sections. (For more information, refer to the <DocLink id="enSecurityD4cPolicyGuide">Defend for Containers policy guide</DocLink>). You can also change these later.
1. Under **Where to add this integration**, select an existing or new agent policy.
1. Click **Save & Continue**, then **Add ((agent)) to your hosts**.
1. On the ((agent)) policy page, click **Add agent** to open the Add agent flyout.
1. In the flyout, go to step 3 (**Install ((agent)) on your host**) and select the **Kubernetes** tab.
1. Download or copy the manifest (`elastic-agent-managed-kubernetes.yml`).
1. Open the manifest using your favorite editor, and uncomment the `#capabilities` section:

    ```console
    #capabilities:
    #  add:
    #    - BPF # (since Linux 5.8) allows loading of BPF programs, create most map types, load BTF, iterate programs and maps.
    #    - PERFMON # (since Linux 5.8) allows attaching of BPF programs used for performance metrics and observability operations.
    #    - SYS_RESOURCE # Allow use of special resources or raising of resource limits. Used by 'Defend for Containers' to modify 'rlimit_memlock'
    ```

1. From the directory where you saved the manifest, run the command `kubectl apply -f elastic-agent-managed-kubernetes.yml`.
1. Wait for the **Confirm agent enrollment** dialogue to show that data has started flowing from your newly-installed agent, then click **Close**.

<div id="d4c-get-started-threat"></div>

## Get started with threat detection

One of the <DocLink id="enSecurityD4cPolicyGuide" section="default-policies">default D4C policies</DocLink> sends process telemetry events (`fork` and `exec`) to ((es)).

In order to detect threats using this data, you'll need active <DocLink id="enSecurityDetectionEngineOverview">detection rules</DocLink>. Elastic has prebuilt detection rules designed for this data. (You can also create your own <DocLink id="enSecurityRulesUiCreate">custom rules</DocLink>.)

To install and enable Elastic's prebuilt rules:

1. Go to **Security > Manage > Rules**, then click **Add Elastic rules**.
1. Use the **Tags** selector to search for `container`. Select the `Data Source: Elastic Defend for Containers` tag. The rules table displays relevant rules.
1. Select all the displayed rules and click **Install _x_ selected rule(s)**.
1. Once the rules have loaded, you will see the Rules management page. Use the **Tags** selector to search for `container`. Select the `Container Workload Protection` tag.
1. Select all the rules with the tag, and then click **Bulk actions > Enable**.

<div id="d4c-get-started-drift"></div>

## Get started with drift detection and prevention

((elastic-sec)) defines container drift as creating a new executable or modifying an existing executable within a container. Blocking drift restricts the number of attack vectors available to bad actors by prohibiting them from using external tools.

One of the <DocLink id="enSecurityD4cPolicyGuide" section="default-policies">default D4C policies</DocLink> creates alerts in ((elastic-sec)) when container drift is detected. Before you enable blocking, we strongly recommend that you observe a production workload using the default policy to ensure that the workload does not create or modify executables as part of its normal operation.

To enable blocking:

1. Add a new selector called `blockDrift`.
1. Go to **Security > Manage > Container Workload Protection > Your integration name**.
1. Under **Selectors**, click **Add selector > File Selector**. By default, it selects the operations `createExecutable` and `modifyExecutable`.
1. Name the selector, for example: `blockDrift`.
1. Scroll down to the **Responses** section and click **Add response > File Response**.
1. Under **Match selectors**, add the name of your new selector, for example: `blockDrift`.
1. Select the **Alert** and **Block** actions.
1. Click **Save integration**.

<div id="d4c-get-started-validation"></div>

## Policy validation
To ensure the stability of your production workloads, you should test policy changes before implementing them in production workloads. We also recommend you test policy changes on a simulated environment with workloads similar to production. This approach allows you to test that policy changes prevent undesirable behavior without disrupting your production workloads.
