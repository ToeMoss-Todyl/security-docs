---
id: serverlessSecurityCspmGetStartedGcp
slug: /serverless/security/cspm-get-started-gcp
title: Get started with CSPM for GCP
description: Start monitoring the security posture of your GCP cloud assets.
tags: [ 'serverless', 'security', 'overview', 'cloud security' ]
status: in review
---

<DocBadge template="technical preview" />
<div id="cspm-get-started-gcp"></div>

<div id="cspm-overview-gcp"></div>

## Overview

This page explains how to get started monitoring the security posture of your cloud assets using the Cloud Security Posture Management (CSPM) feature.

<DocCallOut title="Requirements">

* To view posture data, you need the appropriate user role to read the following ((es)) indices:
    * `logs-cloud_security_posture.findings_latest-*`
    * `logs-cloud_security_posture.scores-*`
    * `Logs-cloud_security_posture.findings`
* The user who gives the CSPM integration GCP permissions must be a GCP project `admin`.

</DocCallOut>

<div id="cspm-setup-gcp"></div>

## Set up CSPM for GCP

To set up CSPM for GCP, first add the CSPM integration, then enable cloud account access.

<div id="cspm-add-and-name-integration-gcp"></div>

### Add your CSPM integration
1. From the Elastic Security **Get started** page, click **Add integrations**.
1. Search for `CSPM`, then click on the result.
1. Click **Add Cloud Security Posture Management (CSPM)**.
1. Give your integration a name that matches the purpose or team of the GCP account you want to monitor, for example, `dev-gcp-project`.

<div id="cspm-set-up-cloud-access-section-gcp"></div>

### Set up cloud account access
To setup CSPM for a GCP project, you will need to have admin privileges for the project.

For most users, the simplest option is to use a Google Cloud Shell script to automatically provision the necessary resources and permissions in your GCP account. This method, as well as two manual options, are described below.

<div id="cspm-set-up-cloudshell"></div>

### Cloud Shell script setup (recommended)

1. Under **Setup Access**, select **Google Cloud Shell**.
1. Under **Where to add this integration**:
    1. Select **New Hosts**.
    1. Name the ((agent)) policy. Use a name that matches the purpose or team of the cloud account or accounts you want to monitor. For example, `dev-gcp-account`.
    1. Click **Save and continue**, then **Add ((agent)) to your hosts**. The **Add agent** wizard appears and provides ((agent)) binaries, which you can download and deploy to a VM in your GCP account.
1. Click **Save and continue**.
1. Copy the command that appears, then click **Launch Google Cloud Shell**. It opens in a new window.
1. Check the box to trust Elastic's `cloudbeat` repo, then click **Confirm**

    ![The cloud shell confirmation popup](../images/cspm-get-started-gcp/-cloud-native-security-cspm-cloudshell-trust.png)

1. In Google Cloud Shell, execute the command you copied earlier. Once it finishes, return to ((kib)) and wait for the confirmation of data received from your new integration. Then you can click **View Assets** to see your data.

<DocCallOut title="Note">
During Cloud Shell setup, the CSPM integration adds roles to Google's default service account, which enables custom role creation and attachment of the service account to a compute instance.
After setup, these roles are removed from the service account. If you attempt to delete the deployment but find the deployment manager lacks necessary permissions, consider adding the missing roles to the service account:
[Project IAM Admin](https://cloud.google.com/iam/docs/understanding-roles#resourcemanager.projectIamAdmin), [Role Administrator](https://cloud.google.com/iam/docs/understanding-roles#iam.roleAdmin).
</DocCallOut>

<div id="cspm-set-up-manual-gcp"></div>

### Manual authentication

To authenticate manually, you'll first need to generate credentials for a new GCP service account with the necessary roles, then provide those credentials to the CSPM integration.

Generate GCP credentials:

1. Access the GCP console and select your project.
1. Navigate to **IAM & Admin -> Service accounts**.
1. Click **Create Service Account**.
1. Provide an account name.
1. Enable the required roles:
    1. `Cloud Asset Viewer`: Grants read access to cloud asset metadata.
    1. `Browser`: Grants read access to the project hierarchy.
1. Click **Continue**, then click **Done**.
1. Select the new service account from the list.
1. Go to the **KEYS** tab, then click **ADD KEY**.
1. Select **JSON** as the key type, then click **CREATE**.

The credentials JSON will download to your local machine. Keep it secure since it provides access to your GCP resources.

Provide credentials to the CSPM integration:

1. On the CSPM setup screen under **Setup Access**, select **Manual**.
1. Enter your GCP **Project ID**.
1. Select either **Credentials File** or **Credentials JSON**, and enter the credentials information in your selected format.
1. Under **Where to add this integration**,
    1. If you want to monitor a GCP project where you have not yet deployed ((agent)):
        1. Select **New Hosts**.
        1. Name the ((agent)) policy. Use a name that matches the purpose or team of the cloud account or accounts you want to monitor. For example, `dev-gcp-account`.
        1. Click **Save and continue**, then **Add ((agent)) to your hosts**. The **Add agent** wizard appears and provides ((agent)) binaries, which you can download and deploy to a VM in your GCP account.
    1. If you want to monitor a GCP project where you have already deployed ((agent)):
        1. Select **Existing hosts**.
        1. Select an agent policy that applies the GCP project you want to monitor.
1. Click **Save and continue**.

Wait for the confirmation that ((kib)) received data from your new integration. Then you can click **View Assets** to see your data.
